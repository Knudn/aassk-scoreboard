{% extends "base.html" %}
{% block content %}


<div class="container mx-auto px-4 sm:px-6 md:px-8 py-6 max-w-6xl">
  <h1 class="text-2xl font-bold text-center mb-8">NORGES CUP 2025</h1>
  
  <!-- Main content - Championship Standings -->
  <div class="space-y-6">
<div class="p-4 mb-4 text-sm text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400" role="alert">
  <span class="font-medium">Info:</span> Ved lik poengsum vil siste løp på Haukeli avgjøre vinner
</div>
	  <!-- Define all classes -->
    {% set all_classes = [
        "2-Takt Turbo Open Modified - Stige",
        "2-Takt Turbo Stock - Stige",
        "600 Stock - Stige",
        "700 Stock - Stige",
        "800 Stock - Stige",
        "900 Stock - Stige",
        "Pro Stock - Stige",
        "Rekrutt 13-14 - Stige",
        "Retro klasse 8 - Stige",
        "Top Fuel - Stige",
        "Trail Unlimited - Stige",
        "Ungdom 14-16 Med Pro Stock 600 - Stige",
        "Ungdom 14-16 Uten Pro Stock 600 - Stige",
	"Trail Turbo - Stige"
    ] %}
    
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th {
      background-color: #4338ca;
      color: white;
      padding: 8px;
      text-align: left;
    }
    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    h1 {
      text-align: center;
    }
  </style>

    <h1>Fullført Resultatliste</h1>


  <table>
    <tr>
      <th>Category</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <td>Ungdom 14-16 Med Pro Stock 600</td>
      <td>Ole Bjørnestad Josdal</td>
      <td>Torleiv Håkon Løyland-Helle</td>
      <td>Aksel Josdal Nymoen</td>
    </tr>
    <tr>
      <td>Retro</td>
      <td>Tom Handeland</td>
      <td>Svein Oskar Waldeland</td>
      <td>Gaute Eikild</td>
    </tr>
    <tr>
      <td>600</td>
      <td>Yngve Ousdal</td>
      <td>Daniel Stulien</td>
      <td>Lukas Helle</td>
    </tr>
    <tr>
      <td>700</td>
      <td>Yngve Ousdal</td>
      <td>Daniel Stulien</td>
      <td>Olav Kristian Stangvik</td>
    </tr>
    <tr>
      <td>800</td>
      <td>Vilde Ketilsdotter Homme</td>
      <td>Jan Sigvald Thorsland</td>
      <td>Aanund Slettetveit</td>
    </tr>
    <tr>
      <td>900</td>
      <td>Yngve Ousdal</td>
      <td>Lars Kåre Egelandsdal Skeie</td>
      <td>Hege Viki</td>
    </tr>
    <tr>
      <td>2-Takt Turbo Open Modified</td>
      <td>Olav Kristian Stangvik</td>
      <td>Jan Sigvald Thorsland</td>
      <td>Espen Bryggeså</td>
    </tr>
    <tr>
      <td>2-Takt Turbo Stock</td>
      <td>Jan Sigvald Thorsland</td>
      <td>Espen Bryggeså</td>
      <td>Gaute Eikild</td>
    </tr>
    <tr>
      <td>Trail Turbo</td>
      <td>Jan Sigvald Thorsland</td>
      <td>Fredrik Åsland/Lars Erik Skeibrok</td>
      <td>—</td>
    </tr>
    <tr>
      <td>Trail Unlimited</td>
      <td>Bjørn Terje Viki</td>
      <td>Fredrik Rysstad</td>
      <td>Daniel Stulien</td>
    </tr>
    <tr>
      <td>Pro Stock</td>
      <td>Yngve Ousdal</td>
      <td>Jan Sigvald Thorsland</td>
      <td>Gaute Eikild</td>
    </tr>
    <tr>
      <td>Top Fuel</td>
      <td>Bjørn Terje Viki</td>
      <td>Fredrik Rysstad</td>
      <td>Dag Gunnar Telhaug</td>
    </tr>
  </table>

    <!-- Define all events -->
    {% set all_events = ["Bortelid Bakkedrag - Norgescup Runde 1", "Haukeli Bakkedrag - Norgescup Runde 2", "Haukeli Bakkedrag - Norgescup Runde 3"] %}
    
    <!-- Loop through categories -->
    {% for class_name in all_classes %}
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <button class="w-full bg-gray-800 text-white px-4 py-3 text-center flex items-center justify-center accordion-toggle" data-target="category-{{ loop.index }}">
          <h2 class="text-lg font-medium">{{ class_name.replace("- Stige", "") }}</h2>
          <svg class="w-5 h-5 ml-2 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        
        <div id="category-{{ loop.index }}" class="accordion-content">
          <div class="p-2 sm:p-3 overflow-x-auto">
            <table class="w-full bg-white text-sm table-fixed">
              <thead>
                <tr class="bg-gray-100">
                  <th class="py-2 px-2 text-center w-12">Rank</th>
                  <th class="py-2 px-2 text-left w-1/3 min-w-48">Driver</th>
                  <th class="py-2 px-2 text-center w-16">Total</th>
                  
                  <!-- Event columns -->
                  {% for event_name in all_events %}
		  	{% if event_name == "Bortelid Bakkedrag - Norgescup Runde 1"  %}
                    		<th class="py-2 px-2 text-center w-20">Bortelid</th>
			{% elif event_name == "Haukeli Bakkedrag - Norgescup Runde 2" %}
				<th class="py-2 px-2 text-center w-20">Haukeli 1</th>
			{% elif event_name == "Haukeli Bakkedrag - Norgescup Runde 3" %}
				<th class="py-2 px-2 text-center w-20">Haukeli 2</th>
			{% endif %}
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% set class_data = data.aggregated_points.get(class_name, []) %}
                {% if class_data %}
                  {% for driver in class_data %}
                    <tr class="border-b hover:bg-gray-50 {% if loop.index == 1 %}bg-yellow-50{% elif loop.index == 2 %}bg-gray-50{% elif loop.index == 3 %}bg-amber-50{% endif %}">
                      <td class="py-2 px-1 text-center font-medium">{{ loop.index }}</td>
                      <td class="py-2 px-2 text-left truncate" title="{{ driver.driver }}">
                        <span class="inline-block text-sm sm:text-base">{{ driver.driver }}</span>
                      </td>
                      <td class="py-2 px-1 text-center font-medium">{{ driver.total_points }}</td>
                      
                      <!-- Points from each event -->
                      {% for event_short_name in all_events %}
                        <td class="py-2 px-1 text-center">
                          {% set found = false %}
                          {% for event_name, event_data in data.items() %}
                            {% if event_name != "aggregated_points" and event_name.startswith(event_short_name) %}
                              {% if class_name in event_data %}
                                {% for event_driver in event_data[class_name] %}
                                  {% if event_driver.driver == driver.driver and not found %}
                                    {{ event_driver.points }}
                                    {% set found = true %}
                                  {% endif %}
                                {% endfor %}
                              {% endif %}
                            {% endif %}
                          {% endfor %}
                          {% if not found %}
                          {% endif %}
                        </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="{{ all_events|length + 3 }}" class="py-4 text-center text-gray-500">No data available for this class yet</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event listeners to all accordion toggles
    const toggles = document.querySelectorAll('.accordion-toggle');
    
    toggles.forEach(toggle => {
      // Open the first accordion by default
      if (toggles[0] === toggle) {
        const targetId = toggle.getAttribute('data-target');
        const content = document.getElementById(targetId);
        content.style.display = 'block';
        toggle.querySelector('svg').classList.add('rotate-180');
      }
      
      toggle.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const content = document.getElementById(targetId);
        
        // Toggle the display
        if (content.style.display === 'block') {
          content.style.display = 'none';
          this.querySelector('svg').classList.remove('rotate-180');
        } else {
          content.style.display = 'block';
          this.querySelector('svg').classList.add('rotate-180');
        }
      });
    });
  });
</script>

<style>
  .accordion-content {
    display: none;
  }
  
  @media (max-width: 640px) {
    .table-fixed th,
    .table-fixed td {
      font-size: 0.75rem;
    }
  }
</style>

{% endblock %}
