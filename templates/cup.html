{% extends "base.html" %}
{% block content %}

<div class="container mx-auto px-4 sm:px-6 md:px-8 py-6 max-w-6xl">
  <h1 class="text-2xl font-bold text-center mb-8">NORGES CUP 2025</h1>
  
  <!-- Main content - Championship Standings -->
  <div class="space-y-6">
    <!-- Define all classes -->
    {% set all_classes = [
        "2-Takt Turbo Open Modified - Stige",
        "2-Takt Turbo Stock - Stige",
        "600 Stock - Stige",
        "700 Stock - Stige",
        "800 Stock - Stige",
        "900 Stock - Stige",
        "Pro Stock - Stige",
        "Rekrutt 13-14 - Stige",
        "Retro klasse 8 - Stige",
        "Top Fuel - Stige",
        "Trail Unlimited - Stige",
        "Ungdom 14-16 Med Pro Stock 600 - Stige",
        "Ungdom 14-16 Uten Pro Stock 600 - Stige"
    ] %}
    
    <!-- Define all events -->
    {% set all_events = ["Bortelid", "Brokke", "Haukeli"] %}
    
    <!-- Loop through categories -->
    {% for class_name in all_classes %}
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <button class="w-full bg-gray-800 text-white px-4 py-3 text-center flex items-center justify-center accordion-toggle" data-target="category-{{ loop.index }}">
          <h2 class="text-lg font-medium">{{ class_name.replace("- Stige", "") }}</h2>
          <svg class="w-5 h-5 ml-2 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        
        <div id="category-{{ loop.index }}" class="accordion-content">
          <div class="p-2 sm:p-3 overflow-x-auto">
            <table class="w-full bg-white text-sm table-fixed">
              <thead>
                <tr class="bg-gray-100">
                  <th class="py-2 px-2 text-center w-12">Rank</th>
                  <th class="py-2 px-2 text-left w-1/3 min-w-48">Driver</th>
                  <th class="py-2 px-2 text-center w-16">Total</th>
                  
                  <!-- Event columns -->
                  {% for event_name in all_events %}
                    <th class="py-2 px-2 text-center w-20">{{ event_name }}</th>
                  {% endfor %}
                </tr>
              </thead>
              <tbody>
                {% set class_data = data.aggregated_points.get(class_name, []) %}
                {% if class_data %}
                  {% for driver in class_data %}
                    <tr class="border-b hover:bg-gray-50 {% if loop.index == 1 %}bg-yellow-50{% elif loop.index == 2 %}bg-gray-50{% elif loop.index == 3 %}bg-amber-50{% endif %}">
                      <td class="py-2 px-1 text-center font-medium">{{ loop.index }}</td>
                      <td class="py-2 px-2 text-left truncate" title="{{ driver.driver }}">
                        <span class="inline-block text-sm sm:text-base">{{ driver.driver }}</span>
                      </td>
                      <td class="py-2 px-1 text-center font-medium">{{ driver.total_points }}</td>
                      
                      <!-- Points from each event -->
                      {% for event_short_name in all_events %}
                        <td class="py-2 px-1 text-center">
                          {% set found = false %}
                          {% for event_name, event_data in data.items() %}
                            {% if event_name != "aggregated_points" and event_name.startswith(event_short_name) %}
                              {% if class_name in event_data %}
                                {% for event_driver in event_data[class_name] %}
                                  {% if event_driver.driver == driver.driver and not found %}
                                    {{ event_driver.points }}
                                    {% set found = true %}
                                  {% endif %}
                                {% endfor %}
                              {% endif %}
                            {% endif %}
                          {% endfor %}
                          {% if not found %}
                          {% endif %}
                        </td>
                      {% endfor %}
                    </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="{{ all_events|length + 3 }}" class="py-4 text-center text-gray-500">No data available for this class yet</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event listeners to all accordion toggles
    const toggles = document.querySelectorAll('.accordion-toggle');
    
    toggles.forEach(toggle => {
      // Open the first accordion by default
      if (toggles[0] === toggle) {
        const targetId = toggle.getAttribute('data-target');
        const content = document.getElementById(targetId);
        content.style.display = 'block';
        toggle.querySelector('svg').classList.add('rotate-180');
      }
      
      toggle.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target');
        const content = document.getElementById(targetId);
        
        // Toggle the display
        if (content.style.display === 'block') {
          content.style.display = 'none';
          this.querySelector('svg').classList.remove('rotate-180');
        } else {
          content.style.display = 'block';
          this.querySelector('svg').classList.add('rotate-180');
        }
      });
    });
  });
</script>

<style>
  .accordion-content {
    display: none;
  }
  
  @media (max-width: 640px) {
    .table-fixed th,
    .table-fixed td {
      font-size: 0.75rem;
    }
  }
</style>

{% endblock %}