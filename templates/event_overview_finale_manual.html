{% extends "base.html" %}

{% block title %}Race Results{% endblock %}

{% block head %}
{{ super() }}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    .pdf-preview {
        width: 100%;
        max-width: 800px;
        height: auto;
        margin: 1rem auto;
    }
    .race-card {
        transition: all 0.2s ease;
    }
    .race-card:hover {
        transform: translateY(-2px);
    }
    .stat_text_scaling {
        font-size: 1.1rem;
    }
    @media (max-width: 570px) {
        .stat_text_scaling {
            font-size: 0.8rem;
        }
    }
    @media (max-width: 600px) {
        .px-6 {
            padding-left: 0.5rem !important;
            padding-right: 0.2rem !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">{{ event_name }}</h1>
    
    <!-- Event Info -->
    <div class="stat_text_scaling text-gray-700 mb-8 flex justify-center items-center flex-wrap gap-4">
        <div class="flex items-center">
            <span class="font-bold mr-2">Klasser:</span>
            <span id="event-count">
                {{ table_data | length }}
        </span>
        </div>
        <div class="hidden sm:block h-6 w-px bg-gray-300"></div>
        <div class="flex items-center">
            <span class="font-bold mr-2">Sjåfører:</span>
            <span id="drivers_num">0</span>
        </div>
        <div class="hidden sm:block h-6 w-px bg-gray-300"></div>
        <div class="flex items-center">
            <span class="font-bold mr-2">Dato:</span>
            <span>{{ table_data[0]["date"] }}</span>
        </div>
    </div>

    <!-- Race Results Container -->
    <div class="space-y-6" id="racesContainer">
        {% for event in table_data %}
            {% for race in event.drivers %}
                <div class="race-card bg-white rounded-lg shadow-md overflow-hidden border-2 border-gray-200">
                    <!-- Race Title -->
                    <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">{{ race.race_title }}</h2>
                    </div>

                    <!-- Top 3 Results -->
                    <div class="p-4">
                        <div class="overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                        <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Navn</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    {% for driver in race.driver_places[:3] %}
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900">
                                            {{ driver.position }}
                                        </td>
                                        <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">
                                            {{ driver.driver }}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- PDF Preview -->
                    {% if race.pdf_filename %}
                    {% set jpg = race.pdf_filename | replace(".pdf", ".jpg") %}
                    <div class="px-4 pb-4">
                        <img src="/static/pdfs/manual_entries/{{ jpg }}" 
                             alt="Race Results" 
                             class="pdf-preview rounded-lg shadow-md">
                    </div>
                    {% endif %}
                </div>
            {% endfor %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let drivers = new Set();
    
    // Collect unique drivers
    document.querySelectorAll('tbody tr td:nth-child(2)').forEach(td => {
        drivers.add(td.textContent.trim());
    });
    
    // Update drivers count
    const driversNumElement = document.getElementById('drivers_num');
    if (driversNumElement) {
        driversNumElement.textContent = drivers.size;
    }
});

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toISOString().split('T')[0];
}
</script>
{% endblock %}